{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\nexport function middleware(request: NextRequest) {\r\n    const userRoleCookie = request.cookies.get('user_role')?.value;\r\n    const path = request.nextUrl.pathname;\r\n\r\n    // --- 1. Master Key Bypass (SUPERADMIN / ADMIN) ---\r\n    // Jika user punya role SUPERADMIN atau ADMIN, izinkan ke SEMUA halaman\r\n    if (userRoleCookie) {\r\n        const role = userRoleCookie.toUpperCase();\r\n        if (role === 'SUPERADMIN' || role === 'SUPER ADMIN' || role.includes('ADMIN')) {\r\n            return NextResponse.next();\r\n        }\r\n    }\r\n\r\n    // --- 2. Role Enforcement ---\r\n\r\n    // Protection: /jury-room\r\n    // Allowed: JURI, PANEL, JUDGE\r\n    if (path.startsWith('/jury-room')) {\r\n        if (!userRoleCookie) {\r\n            return NextResponse.redirect(new URL('/', request.url));\r\n        }\r\n        const role = userRoleCookie.toUpperCase();\r\n        const isJuri = role.includes('JURI') || role.includes('PANEL') || role.includes('JUDGE');\r\n\r\n        if (!isJuri) {\r\n            // Redirect ke halaman yang sesuai jika bukan juri (misal dia koor nyasar ke juri)\r\n            if (role.includes('KOOR')) return NextResponse.redirect(new URL('/koordinator-view', request.url));\r\n            return NextResponse.redirect(new URL('/', request.url));\r\n        }\r\n    }\r\n\r\n    // Protection: /koordinator-view\r\n    // Allowed: KOORDINATOR, KOORDINATOR AKADEMIK\r\n    if (path.startsWith('/koordinator-view')) {\r\n        if (!userRoleCookie) {\r\n            return NextResponse.redirect(new URL('/', request.url));\r\n        }\r\n        const role = userRoleCookie.toUpperCase();\r\n        // Cek \"KOORDINATOR\" men-cover \"KOORDINATOR AKADEMIK\" juga\r\n        const isKoor = role.includes('KOORDINATOR');\r\n\r\n        if (!isKoor) {\r\n            if (role.includes('JURI') || role.includes('PANEL')) return NextResponse.redirect(new URL('/jury-room', request.url));\r\n            return NextResponse.redirect(new URL('/', request.url));\r\n        }\r\n    }\r\n\r\n    // Protection: /admin-dashboard (Admin Biasa)\r\n    // Allowed: ADMIN (Checked in Master Key logic normally, but added here for safety)\r\n    if (path.startsWith('/admin-dashboard')) {\r\n        if (!userRoleCookie) {\r\n            return NextResponse.redirect(new URL('/', request.url));\r\n        }\r\n        // Master Key logic already handles ADMIN, but explicit check:\r\n        // If we are here, it means we are NOT Admin/SuperAdmin (because of step 1), \r\n        // so we should probably block.\r\n        // Wait, master key logic above returns next(). So if we are here, we are NOT Admin.\r\n        return NextResponse.redirect(new URL('/', request.url));\r\n    }\r\n\r\n    // Protection: /super-admin\r\n    if (path.startsWith('/super-admin')) {\r\n        // Only Super Admin or Admin (via Master Key) can enter.\r\n        // If we are here, we are NOT Admin/SuperAdmin.\r\n        return NextResponse.redirect(new URL('/', request.url));\r\n    }\r\n\r\n\r\n    const response = NextResponse.next();\r\n\r\n    // --- 3. Security Headers ---\r\n    response.headers.set('X-Frame-Options', 'DENY');\r\n    response.headers.set('X-Content-Type-Options', 'nosniff');\r\n    response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\r\n    response.headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()');\r\n\r\n    return response;\r\n}\r\n\r\nexport const config = {\r\n    matcher: ['/jury-room/:path*', '/koordinator-view/:path*', '/admin-dashboard/:path*', '/super-admin/:path*'],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGO,SAAS,WAAW,OAAoB;IAC3C,MAAM,iBAAiB,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;IACzD,MAAM,OAAO,QAAQ,OAAO,CAAC,QAAQ;IAErC,oDAAoD;IACpD,uEAAuE;IACvE,IAAI,gBAAgB;QAChB,MAAM,OAAO,eAAe,WAAW;QACvC,IAAI,SAAS,gBAAgB,SAAS,iBAAiB,KAAK,QAAQ,CAAC,UAAU;YAC3E,OAAO,gMAAY,CAAC,IAAI;QAC5B;IACJ;IAEA,8BAA8B;IAE9B,yBAAyB;IACzB,8BAA8B;IAC9B,IAAI,KAAK,UAAU,CAAC,eAAe;QAC/B,IAAI,CAAC,gBAAgB;YACjB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACzD;QACA,MAAM,OAAO,eAAe,WAAW;QACvC,MAAM,SAAS,KAAK,QAAQ,CAAC,WAAW,KAAK,QAAQ,CAAC,YAAY,KAAK,QAAQ,CAAC;QAEhF,IAAI,CAAC,QAAQ;YACT,kFAAkF;YAClF,IAAI,KAAK,QAAQ,CAAC,SAAS,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,qBAAqB,QAAQ,GAAG;YAChG,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACzD;IACJ;IAEA,gCAAgC;IAChC,6CAA6C;IAC7C,IAAI,KAAK,UAAU,CAAC,sBAAsB;QACtC,IAAI,CAAC,gBAAgB;YACjB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACzD;QACA,MAAM,OAAO,eAAe,WAAW;QACvC,0DAA0D;QAC1D,MAAM,SAAS,KAAK,QAAQ,CAAC;QAE7B,IAAI,CAAC,QAAQ;YACT,IAAI,KAAK,QAAQ,CAAC,WAAW,KAAK,QAAQ,CAAC,UAAU,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;YACnH,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACzD;IACJ;IAEA,6CAA6C;IAC7C,mFAAmF;IACnF,IAAI,KAAK,UAAU,CAAC,qBAAqB;QACrC,IAAI,CAAC,gBAAgB;YACjB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACzD;QACA,8DAA8D;QAC9D,6EAA6E;QAC7E,+BAA+B;QAC/B,oFAAoF;QACpF,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACzD;IAEA,2BAA2B;IAC3B,IAAI,KAAK,UAAU,CAAC,iBAAiB;QACjC,wDAAwD;QACxD,+CAA+C;QAC/C,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACzD;IAGA,MAAM,WAAW,gMAAY,CAAC,IAAI;IAElC,8BAA8B;IAC9B,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,sBAAsB;IAE3C,OAAO;AACX;AAEO,MAAM,SAAS;IAClB,SAAS;QAAC;QAAqB;QAA4B;QAA2B;KAAsB;AAChH"}}]
}